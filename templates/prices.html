<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ActionTrackr</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
        crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        th,
        td {
            border: 1px solid black;
            padding: 8px;
            text-align: center;
        }

        table.table-bordered .color-verde {
            color: green;
        }

        table.table-bordered .color-rojo {
            color: red;
        }

        table.table-bordered .color-azul {
            color: blue;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid d-flex justify-content-between">
            <a class="navbar-brand" href="/">
                <img src="{{ url_for('serve_static', filename='Logo.png') }}" alt="Logo" width="30" height="24"
                    class="d-inline-block align-text-top">
                ActionTrackr
            </a>
        </div>
    </nav>

    <form id="csvForm" method="post" action="/download_tabla">
        <input type="hidden" name="nombre_csv" value="Precios.xlsx">
        <div class="d-flex justify-content-between">
            <h3>Precios</h3>
            <button type="submit" class="btn btn-outline-success btn-sm" id="Tabla_datos">Descargar Tabla</button>
        </div>
    </form>


    <div class="container mt-4">
        <table class="table table-bordered" id="datosTabla">
            <tr style="text-align: center;">

            <tr>
                {% for record in data %}
                <th>Fecha</th>
                <th>{{ record.stock_symbol }}</th>
                {% endfor %}
            </tr>

            {% set max_data_length = data|map(attribute='adj_close_data')|map('length')|max %}
  
            {% for i in range(max_data_length) %}
            <tr {% if i == 0 %}hidden{% endif %}>
              {% for record in data %}
                {% if i < record.adj_close_data|length %}
                  <td>{{ record.adj_close_data[i].date }}</td>
                  <td class="columna-{{ record.stock_symbol }}">{{ record.adj_close_data[i].adj_close }}</td>
                {% else %}
                  <td></td>
                  <td></td>
                {% endif %}
              {% endfor %}
            </tr>
          {% endfor %}
        </table>
    </div>
    
    <script src="{{ url_for('serve_script', filename='download_tabla.js') }}"> </script>

    <script>
        $(document).ready(function () {
            // Obtener todas las celdas con clases columna-*
            var cellsWithClasses = document.querySelectorAll('td[class^="columna-"]');
            
            // Iterar a través de las celdas y analizar los valores
            cellsWithClasses.forEach(function(cell) {
                var cellContent = cell.textContent.trim();
                var numeroActual = parseFloat(cellContent);
                
                if (!isNaN(numeroActual)) {
                    // Obtener la clase específica de la celda (por ejemplo, columna-XYZ)
                    var specificClass = cell.className.match(/columna-[A-Za-z0-9]+/);
                    
                    if (specificClass) {
                        specificClass = specificClass[0];
                        var selector = "." + specificClass;
                        
                        // Obtener todas las celdas en la misma columna
                        var cellsInColumn = document.querySelectorAll(selector);
                        
                        // Inicializar el valor anterior como vacío
                        var numeroAnterior = "";
                        
                        // Iterar a través de las celdas en la misma columna y aplicar lógica de colores
                        cellsInColumn.forEach(function(colCell) {
                            var colCellContent = colCell.textContent.trim();
                            var colNumeroActual = parseFloat(colCellContent);
                            
                            if (!isNaN(colNumeroActual)) {
                                if (colNumeroActual > numeroAnterior) {
                                    $(colCell).addClass("color-verde");
                                } else if (colNumeroActual < numeroAnterior) {
                                    $(colCell).addClass("color-rojo");
                                } else if (colNumeroActual === numeroAnterior) {
                                    $(colCell).addClass("color-azul");
                                }
                                
                                numeroAnterior = colNumeroActual;
                            }
                        });
                    }
                }
            });
        });
     </script>
</body>

</html>